pipeline{
    agent any
    stages{
        stage('checkout from git'){
            steps{
                git branch: 'main', url: 'https://github.com/rohanpathak333/reddit-clone-k8s.git'
            }
        }
        stage('Terrafrom version'){
            steps{
                sh 'terraform --version'
            }
        }
        stage('Terrafrom init'){
            steps{
                dir('Eks-terraform'){
                   sh 'terraform init' 
                }
            }
        }
        stage('Terrafrom validate'){
            steps{
                dir('Eks-terraform'){
                   sh 'terraform validate' 
                }
            }
        }
       stage('Terrafrom plan'){
            steps{
                dir('Eks-terraform'){
                   sh 'terraform plan' 
                }
            }
        }
        stage('Terrafrom apply/destroy'){
            steps{
                dir('Eks-terraform'){
                   sh 'terraform ${action} --auto-approve' 
                }
            }
        }
        
    }
}
